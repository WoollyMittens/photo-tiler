/*
	Source:
	van Creij, Maurice (2012). "useful.viewer.js: A simple tile based image viewer", version 20120606, http://www.woollymittens.nl/.

	License:
	This work is licensed under a Creative Commons Attribution 3.0 Unported License.

	Prerequisites:
	<script src="./js/useful.js"></script>
	<!--[if IE]>
		<script src="./js/html5.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
	<![endif]-->
*/(function(e){"use strict";var t={};t={start:function(n,r){if(!r.outlets){r.outlets={};r.thumbnails=[0];r.figures=[0];r.titles=[0];r.descriptions=[0];r.widths=[0];r.heights=[0];var i=n.getElementsByTagName("a"),s=n.getElementsByTagName("img");for(var o=0,u=i.length;o<u;o+=1){r.thumbnails.push(s[o].getAttribute("src"));r.figures.push(r.urlprefix+i[o].getAttribute("href"));r.titles.push(s[o].getAttribute("title"));r.descriptions.push(s[o].getAttribute("alt"));r.widths.push(s[o].getAttribute("width"));r.heights.push(s[o].getAttribute("height"))}r.outlets.index=1;r.outlets.zoom=1;r.outlets.pan={x:.5,y:.5};r.outlets.pos={x:0,y:0};r.outlets.parent=n}r.grid=parseInt(r.grid,10);r.cache=parseInt(r.cache,10);r.lens=parseFloat(r.lens);r.magnification=parseFloat(r.magnification);r.navigation="thumbnails";r.divide=r.spin==="rotation"?1:parseInt(r.divide,10)/100;r.retry=null;r.widths[1]?t.run(r):e.request.send({url:r.imagesize+"?src="+r.figures.join(",").substr(2),post:"name=value&foo=bar",onSuccess:function(e){t.load(e,r)}})},run:function(e){e.outlets.parent.style.visibility="hidden";setTimeout(function(){t.setup(e);setTimeout(function(){t.update(e);e.outlets.parent.style.visibility="visible"},400)},100)},load:function(n,r){var i={};i=e.request.decode(n.responseText);r.widths=[0].concat(i.x);r.heights=[0].concat(i.y);t.run(r)},setup:function(e){var n=e.outlets.parent;n.innerHTML="";e.width&&(n.style.width=e.width+e.widthUnit);e.height&&(n.style.height=e.height+e.heightUnit);n.className+=" spin_"+e.spin;t.automatic.setup(e);t.figures.setup(e);switch(e.toolbars){case"sliders":t.zoom.setup(e);e.spin==="rotation"&&t.spin.setup(e);e.spin==="catalogue"&&t.leaf.setup(e);break;case"buttons":t.toolbar.setup(e);break;default:t.toolbar.setup(e)}e.spin!=="rotation"&&t.thumbnails.setup(e)},update:function(e){if(e.outlets.parent.offsetHeight===0){clearTimeout(e.retry);e.retry=setTimeout(function(){t.update(e)},1e3)}else{t.figures.update(e);switch(e.toolbars){case"sliders":t.zoom.update(e);e.spin==="rotation"&&t.spin.update(e);e.spin==="catalogue"&&t.leaf.update(e);break;case"buttons":t.toolbar.update(e);break;default:t.toolbar.update(e)}e.spin!=="rotation"&&t.thumbnails.update(e)}},automatic:{setup:function(){}},figures:{setup:function(e){e.outlets.stream=!0;e.outlets.count=0;e.outlets.transitions=[];e.outlets.wrapper=document.createElement("div");e.outlets.wrapper.className="wrapper";e.outlets.wrapper.style.height=e.divide*100+"%";e.outlets.canvas=document.createElement("div");e.outlets.canvas.className="canvas";e.outlets.wrapper.appendChild(e.outlets.canvas);e.outlets.figures=[0];var n,r,i;for(var s=1,o=e.figures.length;s<o;s+=1){i=e.outlets.parent.offsetHeight*e.divide;r=i/e.heights[s]*e.widths[s];e.outlets.figures[s]=document.createElement("figure");e.outlets.figures[s].className=s===1?"figure_active":"figure_passive";e.outlets.figures[s].style.width=parseInt(r,10)+"px";e.outlets.figures[s].style.height=parseInt(i,10)+"px";e.outlets.figures[s].style.left=e.outlets.pan.x*100+"%";e.outlets.figures[s].style.top=e.outlets.pan.y*100+"%";e.outlets.figures[s].style.marginLeft=parseInt(r/-2,10)+"px";e.outlets.figures[s].style.marginTop=parseInt(i/-2,10)+"px";n=document.createElement("img");n.src=e.imageslice+"?src="+e.figures[s]+"&width="+parseInt(r,10)+"&height="+parseInt(i,10)+"&left=0&top=0&right=1&bottom=1";n.style.width="100%";n.style.height="100%";n.className="zoom_0";e.descriptions?n.setAttribute("alt",e.descriptions[s]):n.setAttribute("alt","");e.titles?n.setAttribute("title",e.titles[s]):n.setAttribute("title","");e.outlets.figures[s].appendChild(n);e.outlets.canvas.appendChild(e.outlets.figures[s])}e.outlets.cover=document.createElement("div");e.outlets.cover.className="cover";e.outlets.wrapper.appendChild(e.outlets.cover);if(e.zoom!=="static"){e.outlets.background=e.outlets.canvas.cloneNode(!0);e.outlets.background.className="background";e.outlets.wrapper.insertBefore(e.outlets.background,e.outlets.canvas);e.outlets.canvas.className+=" canvas_lens canvas_hidden";e.outlets.zoom=999;if(e.zoom==="lens"){var u=e.outlets.parent.offsetWidth*e.lens;e.outlets.canvas.style.width=u+"px";e.outlets.canvas.style.height=u+"px";navigator.userAgent.match(/firefox|webkit/gi)&&(e.outlets.canvas.style.borderRadius="50%")}var a=e.outlets.background.getElementsByTagName("figure");e.outlets.backgrounds=[];for(s=0,o=a.length;s<o;s+=1){e.outlets.backgrounds[s+1]=a[s];e.outlets.backgrounds[s+1].style.display="block";e.outlets.backgrounds[s+1].style.position="absolute"}}e.outlets.parent.appendChild(e.outlets.wrapper);t.figures.events.coverScroll(e.outlets.cover,e);t.figures.events.coverMouse(e.outlets.cover,e);t.figures.events.coverTouch(e.outlets.cover,e);e.outlets.tiles={}},events:{coverScroll:function(e,n){e.addEventListener?e.addEventListener("mousewheel",function(e){t.figures.mouse.wheel(e,n)},!1):e.attachEvent("onmousewheel",function(e){t.figures.mouse.wheel(e,n)});e.addEventListener&&e.addEventListener("DOMMouseScroll",function(e){t.figures.mouse.wheel(e,n)},!1)},coverMouse:function(e,n){if(n.zoom!=="static")e.onmousemove=function(e){t.figures.mouse.mirror(e,n)};else{e.onmousedown=function(e){t.figures.mouse.start(e,n)};e.onmousemove=function(e){t.figures.mouse.move(e,n)};e.onmouseup=function(e){t.figures.mouse.end(e,n)};e.onmouseout=function(e){t.figures.mouse.end(e,n)}}},coverTouch:function(e,n){if(n.zoom!=="static")e.ontouchmove=function(e){t.figures.touch.mirror(e,n)};else{e.ontouchstart=function(e){t.figures.touch.start(e,n)};e.ontouchmove=function(e){t.figures.touch.move(e,n)};e.ontouchend=function(e){t.figures.touch.end(e,n)}}}},update:function(e){t.figures.redraw.validate(e);t.figures.redraw.calculate(e);t.figures.redraw.normalise(e);t.figures.redraw.canvas(e);t.figures.redraw.figures(e);t.figures.redraw.create(e);t.figures.redraw.display(e);t.figures.redraw.spin(e)},redraw:{validate:function(e){e.outlets.atMinZoom=!1;e.outlets.atMaxZoom=!1;e.outlets.atMinLeaf=!1;e.outlets.atMaxLeaf=!1;var t=e.zoom!=="static"?1/e.lens:1;if(e.outlets.zoom<=t){e.outlets.zoom=t;e.outlets.atMinZoom=!0}if(e.outlets.index<=1){e.outlets.index=1;e.outlets.atMinLeaf=!0}if(e.outlets.index>=e.outlets.figures.length){e.outlets.index=e.outlets.figures.length-1;e.outlets.atMaxLeaf=!0}},calculate:function(e){var n=t.figures.redraw;n.canvasWidth=e.outlets.canvas.offsetWidth;n.canvasHeight=e.outlets.canvas.offsetHeight;n.canvasLeft=e.outlets.pos.x-n.canvasWidth/2;n.canvasTop=e.outlets.pos.y-n.canvasHeight/2;n.maxWidth=e.widths[e.outlets.index];n.maxHeight=e.heights[e.outlets.index];n.figureAspect=n.maxWidth/n.maxHeight;n.figureWidth=n.canvasHeight*n.figureAspect*e.outlets.zoom;n.figureHeight=n.canvasHeight*e.outlets.zoom;n.figureLeft=(e.outlets.pan.x-.5)*n.canvasWidth;n.figureTop=(e.outlets.pan.y-.5)*n.canvasHeight;n.overscanLeft=(n.figureWidth-n.canvasWidth)/2;n.overscanTop=(n.figureHeight-n.canvasHeight)/2;n.offsetLeft=n.overscanLeft-n.figureLeft;n.offsetTop=n.overscanTop-n.figureTop;n.minPanLeft=-n.overscanLeft/n.canvasWidth+.5;n.maxPanLeft=n.overscanLeft/n.canvasWidth+.5;n.minPanTop=-n.overscanTop/n.canvasHeight+.5;n.maxPanTop=n.overscanTop/n.canvasHeight+.5;n.maxZoom=n.maxHeight/n.canvasHeight;if(e.zoom!=="static"){n.backgroundWidth=e.outlets.background.offsetWidth;n.backgroundHeight=e.outlets.background.offsetHeight;n.backgroundLeft=(n.backgroundHeight*n.figureAspect-n.backgroundWidth)/2;n.backgroundTop=0}},normalise:function(e){var n=t.figures.redraw;if(n.figureWidth>=n.maxWidth||n.figureHeight>=n.maxHeight){n.figureWidth=n.maxWidth;n.figureHeight=n.maxHeight;e.outlets.zoom=n.maxZoom;e.outlets.atMaxZoom=!0}if(n.figureLeft>n.overscanLeft){n.figureLeft=n.overscanLeft;e.outlets.pan.x=n.maxPanLeft}if(n.figureLeft<-n.overscanLeft){n.figureLeft=-n.overscanLeft;e.outlets.pan.x=n.minPanLeft}if(n.figureTop>n.overscanTop){n.figureTop=n.overscanTop;e.outlets.pan.y=n.maxPanTop}if(n.figureTop<-n.overscanTop){n.figureTop=-n.overscanTop;e.outlets.pan.y=n.minPanTop}if(n.figureHeight<n.canvasHeight){n.figureWidth=n.canvasHeight/n.maxHeight*n.maxWidth;n.figureHeight=n.canvasHeight;e.outlets.zoom=1;e.outlets.pan.y=.5}if(n.figureWidth<n.canvasWidth){n.figureLeft=0;e.outlets.pan.x=.5}},canvas:function(e){var n=t.figures.redraw;switch(e.zoom){case"lens":var r,i,s,o;r=1-(e.outlets.pos.x+n.backgroundLeft)/(n.backgroundHeight*n.figureAspect);i=n.canvasWidth/n.figureWidth;s=n.maxPanLeft-n.minPanLeft+i*2;o=n.minPanLeft-i;e.outlets.pan.x=r*s+o;r=1-(e.outlets.pos.y+n.backgroundTop)/n.backgroundHeight;i=n.canvasHeight/n.figureHeight;s=n.maxPanTop-n.minPanTop+i*2;o=n.minPanTop-i;e.outlets.pan.y=r*s+o;e.outlets.canvas.style.left=parseInt(n.canvasLeft,10)+"px";e.outlets.canvas.style.top=parseInt(n.canvasTop,10)+"px";break;case"top":e.outlets.canvas.style.left="0px";e.outlets.canvas.style.top="-"+e.outlets.canvas.offsetHeight+"px";break;case"right":e.outlets.canvas.style.left=e.outlets.canvas.offsetWidth+"px";e.outlets.canvas.style.top="0px";break;case"bottom":e.outlets.canvas.style.left="0px";e.outlets.canvas.style.top=e.outlets.canvas.offsetHeight+"px";break;case"left":e.outlets.canvas.style.left="-"+e.outlets.canvas.offsetHeight+"px";e.outlets.canvas.style.top="0px"}e.zoom==="lens"?e.outlets.cover.style.cursor="crosshair":e.outlets.zoom>1||e.spin==="rotation"?e.outlets.cover.style.cursor="move":e.outlets.cover.style.cursor="auto"},figures:function(e){var n=t.figures.redraw;e.outlets.figures[e.outlets.index].style.left=e.outlets.pan.x*100+"%";e.outlets.figures[e.outlets.index].style.top=e.outlets.pan.y*100+"%";e.outlets.figures[e.outlets.index].style.marginLeft=parseInt(n.figureWidth/-2,10)+"px";e.outlets.figures[e.outlets.index].style.marginTop=parseInt(n.figureHeight/-2,10)+"px";e.outlets.figures[e.outlets.index].style.width=parseInt(n.figureWidth,10)+"px";e.outlets.figures[e.outlets.index].style.height=parseInt(n.figureHeight,10)+"px"},create:function(e){var n=t.figures.redraw;if(e.outlets.stream&&e.outlets.zoom>1){var r=Math.ceil(n.figureWidth/e.grid),i=Math.ceil(n.figureHeight/e.grid),s,o,u,a,f,l,c,h=e.figures[e.outlets.index],p=e.outlets.zoom.toString().replace(".","D");for(var d=0;d<r;d+=1)for(var v=0;v<i;v+=1){s="fig_"+h+"_zoom_"+p+"_x_"+d+"_y_"+v;if((d+1)*e.grid>=n.offsetLeft&&d*e.grid<=n.offsetLeft+n.canvasWidth&&(v+1)*e.grid>=n.offsetTop&&v*e.grid<=n.offsetTop+n.canvasHeight&&!e.outlets.tiles[s]){e.outlets.count+=1;e.outlets.tiles[s]={object:document.createElement("img"),figure:e.outlets.index,zoom:e.outlets.zoom,x:d,y:v,index:e.outlets.count};e.outlets.tiles[s].object.className="tile_hidden";t.figures.redraw.events.tileLoad(e.outlets.tiles[s].object,e);o=e.grid;u=e.grid;a=v*u/n.figureHeight;f=(d+1)*o/n.figureWidth;l=(v+1)*u/n.figureHeight;c=d*o/n.figureWidth;if(f>1){o=Math.round((1-c)/(f-c)*o);f=1}if(l>1){u=Math.round((1-a)/(l-a)*u);l=1}e.outlets.tiles[s].object.className="tile_hidden";e.outlets.tiles[s].object.src=e.imageslice+"?src="+e.figures[e.outlets.index]+"&width="+o+"&height="+u+"&top="+a+"&right="+f+"&bottom="+l+"&left="+c;e.outlets.tiles[s].object.style.position="absolute";e.outlets.tiles[s].object.style.left=c*100+"%";e.outlets.tiles[s].object.style.top=a*100+"%";e.outlets.tiles[s].object.style.width=o/n.figureWidth*100+"%";e.outlets.tiles[s].object.style.height=u/n.figureHeight*100+"%";e.outlets.tiles[s].object.style.zIndex=parseInt(e.outlets.zoom*100,10);e.outlets.figures[e.outlets.index].appendChild(e.outlets.tiles[s].object)}}}},display:function(e){var n=t.figures.redraw,r="",i;for(r in e.outlets.tiles)if(e.outlets.tiles.hasOwnProperty(r)){i=e.outlets.tiles[r];if(e.outlets.tiles[r].index<e.outlets.count-e.cache){e.outlets.tiles[r].object.parentNode.removeChild(e.outlets.tiles[r].object);delete e.outlets.tiles[r]}else(i.x+1)*e.grid>=n.offsetLeft&&i.x*e.grid<=n.offsetLeft+n.canvasWidth&&(i.y+1)*e.grid>=n.offsetTop&&i.y*e.grid<=n.offsetTop+n.canvasHeight&&i.zoom<=e.outlets.zoom?i.object.style.display="block":i.object.style.display="none"}},spin:function(n){switch(n.spin){case"catalogue":var r;for(var i=1,s=n.outlets.figures.length;i<s;i+=1){clearTimeout(n.outlets.transitions[i]);r=n.outlets.figures[i].offsetWidth;if(i===n.outlets.index){if(n.outlets.zoom>1)n.outlets.figures[i].style.clip="rect(auto 10000px auto 0px)";else if(n.outlets.figures[i].className!=="figure_leafin"){n.outlets.figures[i].style.clip="rect(auto "+r+"px auto "+r+"px)";n.outlets.figures[i].className="figure_leafin";e.css.setRules(n.outlets.figures[i],{clip:"rect(auto "+r+"px auto 0px)",transform:"translate(0%,0%) rotate(0deg)"},null,600)}}else if(n.outlets.figures[i].className!=="figure_leafout"){t.figures.redraw.events.figureUnreveal(n,i,r);n.outlets.figures[i].className="figure_leafout"}}break;case"slideshow":for(i=1,s=n.outlets.figures.length;i<s;i+=1){n.outlets.figures[i].className=i===n.outlets.index?"figure_fadein":"figure_fadeout";n.zoom!=="static"&&(n.outlets.backgrounds[i].className=i===n.outlets.index?"figure_fadein":"figure_fadeout")}break;default:for(i=1,s=n.outlets.figures.length;i<s;i+=1){n.outlets.figures[i].className=i===n.outlets.index?"figure_active":"figure_passive";n.zoom!=="static"&&(n.outlets.backgrounds[i].className=i===n.outlets.index?"figure_active":"figure_passive")}}},events:{tileLoad:function(e){e.onload=function(){e.className="tile_visible"}},figureUnreveal:function(e,t,n){setTimeout(function(){e.outlets.figures[t].style.clip="rect(auto "+n+"px auto "+n+"px)";e.outlets.figures[t].style.webkitTransform="translate(25%,25%) rotate(45deg)";e.outlets.figures[t].style.MozTransform="translate(25%,25%) rotate(45deg)";e.outlets.figures[t].style.msTransform="translate(25%,25%) rotate(45deg)";e.outlets.figures[t].style.oTransform="translate(25%,25%) rotate(45deg)";e.outlets.figures[t].style.transform="translate(25%,25%) rotate(45deg)"},750)}}},mouse:{x:null,y:null,sensitivity:null,treshold:null,flick:null,delay:null,wheel:function(n,r){var i=t.figures.mouse,s=window.event?window.event.wheelDelta/120:-n.detail/3;s<0?r.outlets.zoom=r.outlets.zoom*r.magnification:s>0&&(r.outlets.zoom=r.outlets.zoom/r.magnification);r.outlets.stream=!1;clearTimeout(i.delay);i.delay=setTimeout(function(){r.outlets.stream=!0;t.update(r)},500);t.update(r);e.events.cancel(n)},start:function(n,r){n=n||window.event;var i=t.figures.mouse;i.x=n.pageX||n.x;i.y=n.pageY||n.y;i.treshold=r.outlets.cover.offsetWidth/10;i.flick=r.outlets.cover.offsetWidth*.6;e.events.cancel(n)},move:function(n,r){n=n||window.event;var i=t.figures.mouse;if(i.x!==null){var s=n.pageX||n.x,o=n.pageY||n.y,u=i.x-s,a=i.y-o;if(r.outlets.zoom>1){r.outlets.pan.x-=u*r.outlets.zoom/r.outlets.figures[r.outlets.index].offsetWidth;r.outlets.pan.y-=a*r.outlets.zoom/r.outlets.figures[r.outlets.index].offsetHeight;i.x=s;i.y=o;t.update(r)}else if(Math.abs(u)>i.treshold&&r.spin==="rotation"||Math.abs(u)>i.flick){r.outlets.index+=u>0?1:-1;if(r.spin==="rotation"){r.outlets.index>=r.outlets.figures.length&&(r.outlets.index=1);r.outlets.index<=0&&(r.outlets.index=r.outlets.figures.length-1)}i.x=s;i.y=o;t.update(r)}}e.events.cancel(n)},end:function(n,r){n=n||window.event;var i=t.figures.mouse;i.x!==null&&t.update(r);i.x=null;i.y=null;e.events.cancel(n)},mirror:function(n,r){var i=e.positions.cursor(n,r.outlets.cover);r.outlets.pos.x=i.x;r.outlets.pos.y=i.y;t.update(r);e.events.cancel(n)}},touch:{x:null,y:null,sensitivity:null,treshold:null,flick:null,delay:null,start:function(e,n){var r=t.figures.touch;r.x=[];r.y=[];for(var i=0,s=e.touches.length;i<s;i+=1){r.x.push(e.touches[i].pageX);r.y.push(e.touches[i].pageY)}r.sensitivity=(n.magnification-1)/5+1;r.treshold=n.outlets.cover.offsetWidth/10;r.flick=n.outlets.cover.offsetWidth*.6},move:function(n,r){n=n||window.event;var i=n.target||n.srcElement,s=t.figures.touch;if(s.x!==null){var o=[],u=[];for(var a=0,f=n.touches.length;a<f;a+=1){o.push(n.touches[a].pageX);u.push(n.touches[a].pageY)}var l=s.x[0]-o[0],c=s.y[0]-u[0];if(o.length>1&&s.x.length>1){Math.abs(o[0]-o[1])+Math.abs(u[0]-u[1])<Math.abs(s.x[0]-s.x[1])+Math.abs(s.y[0]-s.y[1])?r.outlets.zoom=r.outlets.zoom/s.sensitivity:r.outlets.zoom=r.outlets.zoom*s.sensitivity;s.x[0]=o[0];s.y[0]=u[0];s.x[1]=o[1];s.y[1]=u[1];r.outlets.stream=!1;clearTimeout(s.delay);s.delay=setTimeout(function(){r.outlets.stream=!0;t.update(r)},500)}else if(r.outlets.zoom>1||r.spin==="slideshow"){r.outlets.pan.x-=l*r.outlets.zoom/r.outlets.figures[r.outlets.index].offsetWidth;r.outlets.pan.y-=c*r.outlets.zoom/r.outlets.figures[r.outlets.index].offsetHeight;s.x[0]=o[0];s.y[0]=u[0]}else if(Math.abs(l)>s.treshold&&r.spin==="rotation"||Math.abs(l)>s.flick){r.outlets.index+=l>0?1:-1;if(r.spin==="rotation"){r.outlets.index>=r.outlets.figures.length&&(r.outlets.index=1);r.outlets.index<=0&&(r.outlets.index=r.outlets.figures.length-1)}s.x[0]=o[0];s.y[0]=u[0];t.update(r)}t.update(r)}i.blur();e.events.cancel(n)},end:function(e,n){var r=t.figures.touch;r.x=null;r.y=null;t.update(n)},mirror:function(n,r){var i=e.positions.touch(n,r.outlets.cover);r.outlets.pos.x=i.x;r.outlets.pos.y=i.y;t.update(r);e.events.cancel(n)}}},zoom:{setup:function(e){e.outlets.menus=e.outlets.menus||{};e.outlets.menus.zoomMenu=document.createElement("menu");e.outlets.menus.zoomMenu.className="slider zoom";e.outlets.menus.zoomMenu.style.bottom=(1-e.divide)*100+"%";t.zoom.build.slider(e.outlets.menus.zoomMenu,e);t.zoom.build.cover(e.outlets.menus.zoomMenu,e);t.zoom.build.increaser(e.outlets.menus.zoomMenu,e);t.zoom.build.decreaser(e.outlets.menus.zoomMenu,e);e.outlets.parent.appendChild(e.outlets.menus.zoomMenu)},build:{slider:function(e,t){t.outlets.menus.zoomIndicator=navigator.userAgent.match(/WebKit/)||!0?document.createElement("div"):document.createElement("meter");t.outlets.menus.zoomIndicator.className="meter";t.outlets.menus.zoomIndicator.setAttribute("min",1);t.outlets.menus.zoomIndicator.setAttribute("max",t.heights[t.outlets.index]/t.outlets.canvas.offsetHeight);t.outlets.menus.zoomIndicator.setAttribute("value",t.outlets.zoom);t.outlets.menus.zoomSlider=document.createElement("div");t.outlets.menus.zoomSliderIcon=document.createElement("span");t.outlets.menus.zoomSliderIcon.innerHTML=t.outlets.zoom;t.outlets.menus.zoomSlider.appendChild(t.outlets.menus.zoomSliderIcon);t.outlets.menus.zoomIndicator.appendChild(t.outlets.menus.zoomSlider);e.appendChild(t.outlets.menus.zoomIndicator)},cover:function(e,n){n.outlets.menus.zoomCover=document.createElement("div");n.outlets.menus.zoomCover.className="cover";e.appendChild(n.outlets.menus.zoomCover);var r=n.outlets.menus.zoomCover;r.addEventListener?r.addEventListener("mousewheel",function(e){t.zoom.mouse.wheel(e,n)},!1):r.attachEvent("onmousewheel",function(e){t.zoom.mouse.wheel(e,n)});r.addEventListener&&r.addEventListener("DOMMouseScroll",function(e){t.zoom.mouse.wheel(e,n)},!1);r.onmousedown=function(e){t.zoom.mouse.start(e,n)};r.onmousemove=function(e){t.zoom.mouse.move(e,n)};r.onmouseup=function(e){t.zoom.mouse.end(e,n)};r.onmouseout=function(e){t.zoom.mouse.end(e,n)};r.ontouchstart=function(e){t.zoom.touch.start(e,n)};r.ontouchmove=function(e){t.zoom.touch.move(e,n)};r.ontouchend=function(e){t.zoom.touch.end(e,n)}},increaser:function(n,r){r.outlets.menus.zoomIn=document.createElement("button");r.outlets.menus.zoomIn.className="increase";r.outlets.menus.zoomInIcon=document.createElement("span");r.outlets.menus.zoomInIcon.innerHTML="Zoom in";r.outlets.menus.zoomIn.appendChild(r.outlets.menus.zoomInIcon);n.appendChild(r.outlets.menus.zoomIn);r.outlets.menus.zoomIn.onmousedown=function(e){t.zoom.increase(e,r);r.outlets.stream=!1;r.outlets.menus.zoomInRepeat=setInterval(function(){t.zoom.increase(e,r)},300)};r.outlets.menus.zoomIn.onmouseup=function(){clearInterval(r.outlets.menus.zoomInRepeat);r.outlets.stream=!0;t.update(r)};r.outlets.menus.zoomIn.onclick=function(t){e.events.cancel(t)}},decreaser:function(n,r){r.outlets.menus.zoomOut=document.createElement("button");r.outlets.menus.zoomOut.className="decrease";r.outlets.menus.zoomOutIcon=document.createElement("span");r.outlets.menus.zoomOutIcon.innerHTML="Zoom out";r.outlets.menus.zoomOut.appendChild(r.outlets.menus.zoomOutIcon);n.appendChild(r.outlets.menus.zoomOut);r.outlets.menus.zoomOut.onmousedown=function(e){t.zoom.decrease(e,r);r.outlets.stream=!1;r.outlets.menus.zoomOutRepeat=setInterval(function(){t.zoom.decrease(e,r)},300)};r.outlets.menus.zoomOut.onmouseup=function(){clearInterval(r.outlets.menus.zoomOutRepeat);r.outlets.stream=!0;t.update(r)};r.outlets.menus.zoomOut.onclick=function(t){e.events.cancel(t)}}},update:function(e){var t=1,n=e.heights[e.outlets.index]/e.outlets.canvas.offsetHeight,r=e.outlets.zoom;e.outlets.menus.zoomIndicator.setAttribute("value",r);e.outlets.menus.zoomSliderIcon.innerHTML=r;e.outlets.menus.zoomSlider.style.top=100-(r-t)/(n-t)*100+"%"},increase:function(n,r){r.outlets.zoom=r.outlets.zoom*r.magnification;t.update(r);e.events.cancel(n)},decrease:function(n,r){r.outlets.zoom=r.outlets.zoom/r.magnification;t.update(r);e.events.cancel(n)},mouse:{y:null,distance:null,sensitivity:null,fudge:1.1,wheel:function(n,r){var i=window.event?window.event.wheelDelta/120:-n.detail/3;i<0?r.outlets.zoom=r.outlets.zoom*r.magnification:i>0&&(r.outlets.zoom=r.outlets.zoom/r.magnification);t.update(r);e.events.cancel(n)},start:function(n,r){n=n||window.event;var i=t.zoom.mouse;i.y=n.pageY||n.y;i.distance=r.outlets.menus.zoomCover.offsetHeight-r.outlets.menus.zoomIn.offsetHeight-r.outlets.menus.zoomOut.offsetHeight;i.sensitivity=r.heights[r.outlets.index]/r.outlets.canvas.offsetHeight-1;e.events.cancel(n)},move:function(n,r){n=n||window.event;var i=t.zoom.mouse;if(i.y!==null){var s=n.pageY||n.y;r.outlets.zoom+=(i.y-s)/i.distance*i.sensitivity*i.fudge;i.y=s;r.outlets.stream=!1;t.update(r)}e.events.cancel(n)},end:function(n,r){n=n||window.event;var i=t.zoom.mouse;i.y=null;r.outlets.stream=!0;t.update(r);e.events.cancel(n)}},touch:{y:null,distance:null,sensitivity:null,fudge:1.1,start:function(e,n){var r=t.zoom.touch;r.y=[];for(var i=0,s=e.touches.length;i<s;i+=1)r.y.push(e.touches[i].pageY);r.distance=n.outlets.menus.zoomCover.offsetHeight-n.outlets.menus.zoomIn.offsetHeight-n.outlets.menus.zoomOut.offsetHeight;r.sensitivity=n.heights[n.outlets.index]/n.outlets.canvas.offsetHeight-1},move:function(n,r){n=n||window.event;var i=n.target||n.srcElement,s=t.zoom.touch;if(s.y!==null){var o;o=[];for(var u=0,a=n.touches.length;u<a;u+=1)o.push(n.touches[u].pageY);r.outlets.zoom+=(s.y[0]-o[0])/s.distance*s.sensitivity*s.fudge;s.y[0]=o[0];r.outlets.stream=!1;t.update(r)}i.blur();e.events.cancel(n)},end:function(e,n){var r=t.zoom.touch;r.y=null;n.outlets.stream=!0;t.update(n)}}},spin:{setup:function(e){e.outlets.menus=e.outlets.menus||{};e.outlets.menus.spinMenu=document.createElement("menu");e.outlets.menus.spinMenu.className="slider spin";e.outlets.menus.spinMenu.style.bottom=(1-e.divide)*100+"%";t.spin.build.slider(e.outlets.menus.spinMenu,e);t.spin.build.cover(e.outlets.menus.spinMenu,e);t.spin.build.increaser(e.outlets.menus.spinMenu,e);t.spin.build.decreaser(e.outlets.menus.spinMenu,e);e.outlets.parent.appendChild(e.outlets.menus.spinMenu)},build:{slider:function(e,t){t.outlets.menus.spinIndicator=navigator.userAgent.match(/WebKit/)||!0?document.createElement("div"):document.createElement("meter");t.outlets.menus.spinIndicator.className="meter";t.outlets.menus.spinIndicator.setAttribute("min",1);t.outlets.menus.spinIndicator.setAttribute("max",t.figures.length);t.outlets.menus.spinIndicator.setAttribute("value",t.outlets.index);t.outlets.menus.spinSlider=document.createElement("div");t.outlets.menus.spinSliderIcon=document.createElement("span");t.outlets.menus.spinSliderIcon.innerHTML=t.outlets.index;t.outlets.menus.spinSlider.appendChild(t.outlets.menus.spinSliderIcon);t.outlets.menus.spinIndicator.appendChild(t.outlets.menus.spinSlider);e.appendChild(t.outlets.menus.spinIndicator)},cover:function(e,n){n.outlets.menus.spinCover=document.createElement("div");n.outlets.menus.spinCover.className="cover";e.appendChild(n.outlets.menus.spinCover);var r=n.outlets.menus.spinCover;r.addEventListener?r.addEventListener("mousewheel",function(e){t.spin.mouse.wheel(e,n)},!1):r.attachEvent("onmousewheel",function(e){t.spin.mouse.wheel(e,n)});r.addEventListener&&r.addEventListener("DOMMouseScroll",function(e){t.spin.mouse.wheel(e,n)},!1);r.onmousedown=function(e){t.spin.mouse.start(e,n)};r.onmousemove=function(e){t.spin.mouse.move(e,n)};r.onmouseup=function(e){t.spin.mouse.end(e,n)};r.onmouseout=function(e){t.spin.mouse.end(e,n)};r.ontouchstart=function(e){t.spin.touch.start(e,n)};r.ontouchmove=function(e){t.spin.touch.move(e,n)};r.ontouchend=function(e){t.spin.touch.end(e,n)}},increaser:function(e,n){n.outlets.menus.spinIn=document.createElement("button");n.outlets.menus.spinIn.className="increase";n.outlets.menus.spinInIcon=document.createElement("span");n.outlets.menus.spinInIcon.innerHTML="Spin left";n.outlets.menus.spinIn.appendChild(n.outlets.menus.spinInIcon);e.appendChild(n.outlets.menus.spinIn);n.outlets.menus.spinIn.onmousedown=function(e){t.spin.increase(e,n);n.outlets.stream=!1;n.outlets.menus.spinInRepeat=setInterval(function(){t.spin.increase(e,n)},300)};n.outlets.menus.spinIn.onmouseup=function(){clearInterval(n.outlets.menus.spinInRepeat);n.outlets.stream=!0;t.update(n)}},decreaser:function(e,n){n.outlets.menus.spinOut=document.createElement("button");n.outlets.menus.spinOut.className="decrease";n.outlets.menus.spinOutIcon=document.createElement("span");n.outlets.menus.spinOutIcon.innerHTML="Spin right";n.outlets.menus.spinOut.appendChild(n.outlets.menus.spinOutIcon);e.appendChild(n.outlets.menus.spinOut);n.outlets.menus.spinOut.onmousedown=function(e){t.spin.decrease(e,n);n.outlets.stream=!1;n.outlets.menus.spinOutRepeat=setInterval(function(){t.spin.decrease(e,n)},300)};n.outlets.menus.spinOut.onmouseup=function(){clearInterval(n.outlets.menus.spinOutRepeat);n.outlets.stream=!0;t.update(n)}}},update:function(e){e.outlets.menus.spinSlider.style.left=(e.outlets.index-1)/(e.outlets.figures.length-2)*100+"%";e.outlets.menus.spinIndicator.setAttribute("value",e.outlets.index);e.outlets.menus.spinSliderIcon.innerHTML=e.outlets.index},increase:function(n,r){r.outlets.index-=1;r.outlets.index<=0&&(r.outlets.index=r.outlets.figures.length-1);t.update(r);e.events.cancel(n)},decrease:function(n,r){r.outlets.index+=1;r.outlets.index>=r.outlets.figures.length&&(r.outlets.index=1);t.update(r);e.events.cancel(n)},mouse:{x:null,sensitivity:null,fudge:.7,wheel:function(e,n){var r=t.spin,i=window.event?window.event.wheelDelta/120:-e.detail/3;i<0?r.increase(e,n):i>0&&r.decrease(e,n)},start:function(n,r){n=n||window.event;var i=t.spin.mouse;i.x=n.pageX||n.x;i.sensitivity=(r.outlets.menus.spinCover.offsetWidth-r.outlets.menus.spinIn.offsetWidth-r.outlets.menus.spinOut.offsetWidth)/r.outlets.figures.length*i.fudge;e.events.cancel(n)},move:function(n,r){n=n||window.event;var i=t.spin.mouse;if(i.x!==null){var s=n.pageX||n.x,o=i.x-s;if(o<-i.sensitivity){r.outlets.index+=1;i.x=s;t.update(r)}else if(o>i.sensitivity){r.outlets.index-=1;i.x=s;t.update(r)}}e.events.cancel(n)},end:function(n){n=n||window.event;var r=t.spin.mouse;r.x=null;e.events.cancel(n)}},touch:{x:null,sensitivity:null,start:function(n,r){n=n||window.event;var i=t.spin.touch;i.x=[];for(var s=0,o=n.touches.length;s<o;s+=1)i.x.push(n.touches[s].pageX);i.sensitivity=(r.outlets.menus.spinCover.offsetWidth-r.outlets.menus.spinIn.offsetWidth-r.outlets.menus.spinOut.offsetWidth)/r.outlets.figures.length;e.events.cancel(n)},move:function(e,n){e=e||window.event;var r=t.spin.touch;if(r.x!==null){var i=[];for(var s=0,o=e.touches.length;s<o;s+=1)i.push(e.touches[s].pageX);var u=r.x[0]-i[0];if(u<-r.sensitivity){n.outlets.index+=1;n.outlets.index>=n.outlets.figures.length&&(n.outlets.index=1);r.x[0]=i[0];t.update(n)}else if(u>r.sensitivity){n.outlets.index-=1;n.outlets.index<=0&&(n.outlets.index=n.outlets.figures.length-1);r.x[0]=i[0];t.update(n)}}},end:function(n){n=n||window.event;var r=t.spin.touch;r.x=null;e.events.cancel(n)}}},thumbnails:{setup:function(e){e.outlets.slideNav=document.createElement("nav");e.outlets.slideNav.className="thumbnails";e.outlets.slideDiv=document.createElement("div");e.outlets.slideUl=document.createElement("ul");e.divide&&(e.outlets.slideNav.style.height=100-e.divide*100-parseInt(e.margin,10)+"%");e.margin&&(e.pixelMargin=parseInt(e.outlets.parent.offsetWidth*parseInt(e.margin,10)/100,10));e.outlets.thumbnails=[0];for(var n=1;n<e.thumbnails.length;n+=1){var r=document.createElement("li"),i=document.createElement("a");i.className=n===1?e.navigation+"_active":e.navigation+"_passive";var s=document.createElement("img");s.style.marginRight=e.pixelMargin+"px";s.alt="";s.src=e.thumbnails[n];s.style.borderColor=e.highlight;i.appendChild(s);i.style.borderColor=e.highlight;r.appendChild(i);e.outlets.slideUl.appendChild(r);e.outlets.thumbnails[n]=i}e.outlets.slideDiv.appendChild(e.outlets.slideUl);e.outlets.slideNav.appendChild(e.outlets.slideDiv);e.outlets.parent.appendChild(e.outlets.slideNav);for(n=1;n<e.thumbnails.length;n+=1)t.thumbnails.events.thumbnailClick(e.outlets.thumbnails[n],e);t.thumbnails.menu.setup(e)},events:{thumbnailClick:function(e,n){e.onclick=function(r){t.thumbnails.set(r,e,n)}}},update:function(n){t.thumbnails.menu.update(n);for(var r=1;r<n.thumbnails.length;r+=1){n.outlets.thumbnails[r].className=n.outlets.index===r?n.navigation+"_active":n.navigation+"_passive";n.outlets.thumbnails[r].style.backgroundColor=n.outlets.index===r?n.highlight:"Transparent"}var i=n.outlets.thumbnails[n.outlets.index].getElementsByTagName("img")[0],s=i.offsetLeft,o=i.offsetWidth,u=n.outlets.slideDiv.offsetWidth,a=-1*s+u/2-o/2;a=a>0?0:a;a=a<n.scrollMax&&n.scrollMax<0?n.scrollMax:a;n.navigation==="thumbnails"&&e.css.setRules(n.outlets.slideUl,{marginLeft:a+"px"})},set:function(n,r,i){n=n||window.event;for(var s=1;s<i.outlets.thumbnails.length;s+=1)if(i.outlets.thumbnails[s]===r){i.outlets.index=s;i.outlets.zoom=i.zoom!=="static"?999:1;t.update(i)}e.events.cancel(n)},menu:{setup:function(e){e.outlets.pageMenu=document.createElement("menu");e.outlets.pageMenu.className="scroller";e.outlets.nextPage=document.createElement("button");e.outlets.nextPage.className="next";e.outlets.nextPageIcon=document.createElement("span");e.outlets.nextPageIcon.innerHTML="&gt";e.outlets.prevPage=document.createElement("button");e.outlets.prevPage.className="previous";e.outlets.prevPageIcon=document.createElement("span");e.outlets.prevPageIcon.innerHTML="&lt";e.outlets.nextPage.appendChild(e.outlets.nextPageIcon);e.outlets.pageMenu.appendChild(e.outlets.nextPage);e.outlets.prevPage.appendChild(e.outlets.prevPageIcon);e.outlets.pageMenu.appendChild(e.outlets.prevPage);e.outlets.slideNav.appendChild(e.outlets.pageMenu);e.outlets.nextPage.onclick=function(n){t.thumbnails.menu.next(n,e.outlets.nextSlide,e)};e.outlets.prevPage.onclick=function(n){t.thumbnails.menu.prev(n,e.outlets.prevSlide,e)}},update:function(e){e.scrollPosition=e.outlets.slideUl.style.marginLeft?parseInt(e.outlets.slideUl.style.marginLeft,10):0;e.scrollDistance=e.outlets.slideDiv.offsetWidth;e.scrollMin=0;var t=e.outlets.thumbnails[e.outlets.thumbnails.length-1].getElementsByTagName("img")[0];e.scrollStep=t.offsetWidth;e.scrollMax=-1*(t.offsetLeft+t.offsetWidth)+e.scrollDistance;e.outlets.prevPage.className=e.outlets.prevPage.className.replace(/ disabled/gi,"");e.outlets.prevPage.className+=e.scrollPosition>=e.scrollMin?" disabled":"";e.outlets.nextPage.className=e.outlets.nextPage.className.replace(/ disabled/gi,"");e.outlets.nextPage.className+=e.scrollPosition<=e.scrollMax&&e.scrollMax<0?" disabled":""},next:function(n,r,i){n=n||window.event;var s=n.target||n.srcElement;if(!s.className.match(/disabled/)){var o=i.scrollPosition-i.scrollDistance+i.scrollStep;o<i.scrollMax&&(o=i.scrollMax);e.css.setRules(i.outlets.slideUl,{marginLeft:o+"px"});t.thumbnails.menu.update(i)}s.blur();e.events.cancel(n)},prev:function(n,r,i){n=n||window.event;var s=n.target||n.srcElement;if(!s.className.match(/disabled/)){var o=i.scrollPosition+i.scrollDistance-i.scrollStep;o>0&&(o=0);i.navigation==="thumbnails"&&e.css.setRules(i.outlets.slideUl,{marginLeft:o+"px"});t.thumbnails.menu.update(i)}s.blur();e.events.cancel(n)}}},leaf:{setup:function(e){e.outlets.menus=e.outlets.menus||{};e.outlets.menus.leafMenu=document.createElement("menu");
e.outlets.menus.leafMenu.className="slider leaf";e.outlets.menus.leafMenu.style.bottom=(1-e.divide)*100+"%";t.leaf.build.indicator(e.outlets.menus.leafMenu,e);t.leaf.build.resetter(e.outlets.menus.leafMenu,e);t.leaf.build.increaser(e.outlets.menus.leafMenu,e);t.leaf.build.decreaser(e.outlets.menus.leafMenu,e);e.outlets.parent.appendChild(e.outlets.menus.leafMenu)},build:{indicator:function(n,r){r.outlets.menus.leafPage=document.createElement("form");r.outlets.menus.leafPageInput=document.createElement("input");r.outlets.menus.leafPageInput.setAttribute("type","text");r.outlets.menus.leafPageCount=document.createElement("span");r.outlets.menus.leafPageCount.className="count";r.outlets.menus.leafPageSubmit=document.createElement("button");r.outlets.menus.leafPageSubmit.setAttribute("type","submit");r.outlets.menus.leafPageSubmit.style.position="absolute";r.outlets.menus.leafPageSubmit.style.left="-999em";r.outlets.menus.leafPage.appendChild(r.outlets.menus.leafPageInput);r.outlets.menus.leafPage.appendChild(r.outlets.menus.leafPageCount);n.appendChild(r.outlets.menus.leafPage);r.outlets.menus.leafPageInput.onchange=function(e){t.leaf.typed(e,r)};r.outlets.menus.leafPage.onsubmit=function(n){t.leaf.typed(n,r);e.events.cancel(n)}},resetter:function(e,n){n.outlets.menus.leafReset=document.createElement("button");n.outlets.menus.leafReset.className="reset";n.outlets.menus.leafResetIcon=document.createElement("span");n.outlets.menus.leafResetIcon.innerHTML="Reset view";n.outlets.menus.leafReset.appendChild(n.outlets.menus.leafResetIcon);e.appendChild(n.outlets.menus.leafReset);n.outlets.menus.leafReset.onclick=function(e){t.leaf.reset(e,n)}},increaser:function(e,n){n.outlets.menus.leafIn=document.createElement("button");n.outlets.menus.leafIn.className="increase";n.outlets.menus.leafInIcon=document.createElement("span");n.outlets.menus.leafInIcon.innerHTML="Leaf forward";n.outlets.menus.leafIn.appendChild(n.outlets.menus.leafInIcon);e.appendChild(n.outlets.menus.leafIn);n.outlets.menus.leafIn.onclick=function(e){t.leaf.increase(e,n)}},decreaser:function(e,n){n.outlets.menus.leafOut=document.createElement("button");n.outlets.menus.leafOut.className="decrease";n.outlets.menus.leafOutIcon=document.createElement("span");n.outlets.menus.leafOutIcon.innerHTML="Leaf back";n.outlets.menus.leafOut.appendChild(n.outlets.menus.leafOutIcon);e.appendChild(n.outlets.menus.leafOut);n.outlets.menus.leafOut.onclick=function(e){t.leaf.decrease(e,n)}}},update:function(e){e.outlets.menus.leafPageInput.value=e.outlets.index;e.outlets.menus.leafPageCount.innerHTML="of "+(e.outlets.figures.length-1)},increase:function(n,r){r.outlets.index+=1;if(r.toolbars==="buttons"){r.outlets.index>=r.outlets.figures.length&&(r.outlets.index=1);r.outlets.index<=0&&(r.outlets.index=r.outlets.figures.length-1)}t.update(r);e.events.cancel(n)},decrease:function(n,r){r.outlets.index-=1;t.update(r);e.events.cancel(n)},typed:function(e,n){var r=parseInt(n.outlets.menus.leafPageInput.value,10);isNaN(r)||(n.outlets.index=r);t.update(n)},reset:function(n,r){r.outlets.zoom=r.zoom!=="static"?999:1;t.update(r);e.events.cancel(n)}},toolbar:{setup:function(e){e.outlets.menus=e.outlets.menus||{};e.outlets.menus.toolbarNav=document.createElement("nav");e.outlets.menus.toolbarNav.className=e.toolbars+" "+e.spin;e.outlets.menus.toolbarNav.style.bottom=(1-e.divide)*100+"%";e.outlets.menus.toolbarZoom=document.createElement("menu");e.outlets.menus.toolbarZoom.className="zoom";t.zoom.build.increaser(e.outlets.menus.toolbarZoom,e);t.zoom.build.decreaser(e.outlets.menus.toolbarZoom,e);e.outlets.menus.toolbarNav.appendChild(e.outlets.menus.toolbarZoom);switch(e.spin){case"rotation":e.outlets.menus.toolbarSpin=document.createElement("menu");e.outlets.menus.toolbarSpin.className="spin";t.spin.build.decreaser(e.outlets.menus.toolbarSpin,e);t.spin.build.increaser(e.outlets.menus.toolbarSpin,e);e.outlets.menus.toolbarNav.appendChild(e.outlets.menus.toolbarSpin);break;case"slideshow":e.outlets.menus.toolbarLeaf=document.createElement("menu");e.outlets.menus.toolbarLeaf.className="leaf";t.leaf.build.decreaser(e.outlets.menus.toolbarLeaf,e);t.leaf.build.increaser(e.outlets.menus.toolbarLeaf,e);e.outlets.menus.toolbarNav.appendChild(e.outlets.menus.toolbarLeaf);break;case"catalogue":e.outlets.menus.toolbarLeaf=document.createElement("menu");e.outlets.menus.toolbarLeaf.className="leaf";t.leaf.build.resetter(e.outlets.menus.toolbarLeaf,e);t.leaf.build.indicator(e.outlets.menus.toolbarLeaf,e);t.leaf.build.decreaser(e.outlets.menus.toolbarLeaf,e);t.leaf.build.increaser(e.outlets.menus.toolbarLeaf,e);e.outlets.menus.toolbarNav.appendChild(e.outlets.menus.toolbarLeaf)}e.outlets.parent.appendChild(e.outlets.menus.toolbarNav)},update:function(e){e.outlets.menus.zoomIn.className=e.outlets.menus.zoomIn.className.replace(/ disabled/gi,"");e.outlets.menus.zoomIn.className+=e.outlets.atMaxZoom?" disabled":"";e.outlets.menus.zoomOut.className=e.outlets.menus.zoomOut.className.replace(/ disabled/gi,"");e.outlets.menus.zoomOut.className+=e.outlets.atMinZoom?" disabled":"";switch(e.spin){case"rotation":break;case"slideshow":e.outlets.menus.leafIn.className=e.outlets.menus.leafIn.className.replace(/ disabled/gi,"");e.outlets.menus.leafIn.className+=e.outlets.atMaxLeaf?" disabled":"";e.outlets.menus.leafOut.className=e.outlets.menus.leafOut.className.replace(/ disabled/gi,"");e.outlets.menus.leafOut.className+=e.outlets.atMinLeaf?" disabled":"";break;case"catalogue":e.outlets.menus.leafPageInput.value=e.outlets.index;e.outlets.menus.leafPageCount.innerHTML="of "+(e.outlets.figures.length-1)}}}};e.events=e.events||{};e.events.add=function(e,t,n){t=navigator.userAgent.match(/Firefox/i)&&t.match(/mousewheel/i)?"DOMMouseScroll":t;"addEventListener"in e?e.addEventListener(t,n,!1):"attachEvent"in e?e.attachEvent("on"+t,function(e){n(e)}):e["on"+t]=n};e.events.cancel=function(e){e&&(e.preventDefault?e.preventDefault():e.preventManipulation?e.preventManipulation():e.returnValue=!1)};e.models=e.models||{};e.models.clone=function(e){var t,n;if(typeof Object.create!="undefined")t=Object.create(e);else{n=function(){};n.prototype=e;t=new n}return t};e.css=e.css||{};e.css.select=function(t,n){var r,i,s;n=n||document;t=typeof t=="string"?{rule:t,parent:n}:t;t.parent=t.parent||document;t.data=t.data||{};s=typeof document.querySelectorAll!="undefined"?t.parent.querySelectorAll(t.rule):typeof jQuery!="undefined"?jQuery(t.parent).find(t.rule).get():[];if(typeof t.handler=="undefined")return s;for(r=0,i=s.length;r<i;r+=1)t.handler(s[r],e.models.clone(t.data))};e.css.compatibility=function(){var e,t,n;t=document.createElement("div");typeof t.style.MozTransition!="undefined"&&(e="transitionend");try{document.createEvent("OTransitionEvent");e="oTransitionEnd"}catch(r){n=null}try{document.createEvent("WebKitTransitionEvent");e="webkitTransitionEnd"}catch(r){n=null}try{document.createEvent("transitionEvent");e="transitionend"}catch(r){n=null}t=n;return e};e.css.prefix=function(e){return navigator.userAgent.match(/webkit/gi)?"webkit"+e.substr(0,1).toUpperCase()+e.substr(1):navigator.userAgent.match(/firefox/gi)?"Moz"+e.substr(0,1).toUpperCase()+e.substr(1):navigator.userAgent.match(/microsoft/gi)?"ms"+e.substr(0,1).toUpperCase()+e.substr(1):navigator.userAgent.match(/opera/gi)?"O"+e.substr(0,1).toUpperCase()+e.substr(1):e};e.css.setRules=function(t,n,r){var i,s,o;n.transitionProperty=n.transitionProperty||"all";n.transitionDuration=n.transitionDuration||"300ms";n.transitionTimingFunction=n.transitionTimingFunction||"ease";r=r||function(){};s=e.css.compatibility();if(typeof s!="undefined"){t.addEventListener(s,o=function(){r();t.removeEventListener(s,o,!0)},!0);for(i in n)if(n.hasOwnProperty(i)){t.style[e.css.compatibility(i)]=n[i];t.style[i]=n[i]}}else if(typeof jQuery!="undefined"){var u,a;u=n.transitionTimingFunction.match(/ease/gi)?"swing":"linear";a=parseInt(n.transitionDuration.replace(/s/g,"000").replace(/ms/g,""),10);delete n.transitionProperty;delete n.transitionDuration;delete n.transitionTimingFunction;jQuery(t).animate(n,a,u,r)}else{for(i in n)if(n.hasOwnProperty(i)){t.style[e.css.compatibility(i)]=n[i];t.style[i]=n[i]}r()}};e.positions=e.positions||{};e.positions.object=function(e){var t={x:0,y:0};if(e.offsetParent)while(e.offsetParent){t.x+=e.offsetLeft;t.y+=e.offsetTop;e=e.offsetParent}return t};e.positions.cursor=function(t,n){t=t||window.event;var r={x:0,y:0};r.x=t.pageX||t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;r.y=t.pageY||t.clientY+document.body.scrollTop+document.documentElement.scrollTop;if(n){var i=e.positions.object(n);r.x-=i.x;r.y-=i.y}return r};e.viewer={};e.viewer.start=t.start})(window.useful=window.useful||{});